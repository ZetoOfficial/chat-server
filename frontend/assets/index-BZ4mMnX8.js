var a=Object.defineProperty;var d=(r,e,t)=>e in r?a(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>d(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class l{constructor(e){i(this,"container");const t=document.getElementById(e);if(!t)throw new Error(`Элемент с id "${e}" не найден.`);this.container=t}addMessage(e){const t=document.createElement("p");t.innerHTML=`<strong>${e.user}:</strong> ${e.content}`,this.container.appendChild(t),this.container.scrollTop=this.container.scrollHeight}addMessages(e){e.forEach(t=>this.addMessage(t))}}class h{constructor(e){i(this,"container");const t=document.getElementById(e);if(!t)throw new Error(`Элемент с id "${e}" не найден.`);this.container=t}setUsers(e){this.container.innerHTML="",e.forEach(t=>{const o=document.createElement("li");o.textContent=t,this.container.appendChild(o)})}}class u{constructor(e,t,o){i(this,"input");i(this,"button");i(this,"onSend");const s=document.getElementById(e),n=document.getElementById(t);if(!s||!n)throw new Error(`Элементы с id "${e}" или "${t}" не найдены.`);this.input=s,this.button=n,this.onSend=o,this.button.addEventListener("click",()=>this.handleSend()),this.input.addEventListener("keypress",c=>{c.key==="Enter"&&this.handleSend()})}handleSend(){const e=this.input.value.trim();e&&(this.onSend(e),this.input.value="")}}class g{constructor(e){i(this,"ws");i(this,"messageList");i(this,"userList");this.ws=new WebSocket(e),this.messageList=new l("messages"),this.userList=new h("users"),new u("msgInput","sendBtn",t=>this.sendMessage(t)),this.ws.onopen=()=>{console.log("WebSocket соединение установлено.")},this.ws.onmessage=t=>{const o=JSON.parse(t.data);this.handleServerMessage(o)},this.ws.onclose=()=>{console.log("WebSocket соединение закрыто.")},this.ws.onerror=t=>{console.error("WebSocket ошибка:",t)}}handleServerMessage(e){switch(e.type){case"message":this.messageList.addMessage(e.data);break;case"users":this.userList.setUsers(e.data);break;case"history":this.messageList.addMessages(e.data);break;default:console.warn("Неизвестный тип сообщения:",e.type)}}sendMessage(e){const t={user:"",content:e};this.ws.send(JSON.stringify(t))}}const f="ws://localhost:8090/ws",p=new g(f);console.log("Chat initialized:",p);
